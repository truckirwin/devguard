{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "S3AccessForNotesGenUploads",
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject"
      ],
      "Resource": [
        "arn:aws:s3:::notesgen-uploads-*/*",
        "arn:aws:s3:::notesgen-documents-*/*"
      ],
      "Condition": {
        "StringEquals": {
          "s3:x-amz-server-side-encryption": "AES256"
        }
      }
    },
    {
      "Sid": "S3ListBucketAccess",
      "Effect": "Allow", 
      "Action": [
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::notesgen-uploads-*",
        "arn:aws:s3:::notesgen-documents-*"
      ],
      "Condition": {
        "StringLike": {
          "s3:prefix": [
            "ppt-files/*",
            "slide-images/*",
            "text-extracts/*"
          ]
        }
      }
    },
    {
      "Sid": "CloudWatchLogsAccess",
      "Effect": "Allow",
      "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents",
        "logs:DescribeLogStreams"
      ],
      "Resource": [
        "arn:aws:logs:*:*:log-group:/notesgen/application:*",
        "arn:aws:logs:*:*:log-group:/notesgen/errors:*"
      ]
    },
    {
      "Sid": "SSMParameterReadAccess",
      "Effect": "Allow",
      "Action": [
        "ssm:GetParameter",
        "ssm:GetParameters"
      ],
      "Resource": [
        "arn:aws:ssm:*:*:parameter/notesgen/database/*",
        "arn:aws:ssm:*:*:parameter/notesgen/app-config/*"
      ],
      "Condition": {
        "StringEquals": {
          "ssm:ParameterTag/Environment": ["dev", "staging", "prod"],
          "ssm:ParameterTag/Project": "NotesGen"
        }
      }
    },
    {
      "Sid": "RDSConnectAccess",
      "Effect": "Allow",
      "Action": [
        "rds-db:connect"
      ],
      "Resource": [
        "arn:aws:rds-db:*:*:dbuser:notesgen-db-*/notesgen-app-user"
      ]
    },
    {
      "Sid": "KMSDecryptAccess",
      "Effect": "Allow",
      "Action": [
        "kms:Decrypt",
        "kms:DescribeKey"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "kms:ViaService": [
            "s3.us-east-1.amazonaws.com",
            "s3.us-west-2.amazonaws.com",
            "ssm.us-east-1.amazonaws.com", 
            "ssm.us-west-2.amazonaws.com"
          ]
        }
      }
    },
    {
      "Sid": "EC2MetadataAccess",
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeInstances",
        "ec2:DescribeTags"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/*"
        }
      }
    },
    {
      "Sid": "BedrockAccessForAINotesGeneration",
      "Effect": "Allow",
      "Action": [
        "bedrock:InvokeModel",
        "bedrock:InvokeModelWithResponseStream"
      ],
      "Resource": [
        "arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-3-sonnet-20240229-v1:0",
        "arn:aws:bedrock:us-west-2::foundation-model/anthropic.claude-3-sonnet-20240229-v1:0",
        "arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-3-5-sonnet-20240620-v1:0",
        "arn:aws:bedrock:us-west-2::foundation-model/anthropic.claude-3-5-sonnet-20240620-v1:0"
      ]
    }
  ]
} 